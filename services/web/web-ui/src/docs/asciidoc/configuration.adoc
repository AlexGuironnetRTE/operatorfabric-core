// Copyright (c) 2018, RTE (http://www.rte-france.com)
//
// This Source Code Form is subject to the terms of the Mozilla Public
// License, v. 2.0. If a copy of the MPL was not distributed with this
// file, You can obtain one at http://mozilla.org/MPL/2.0/.

= Web UI

Operator Fabric Web UI service is a Spring MVC application bootstrapped using
SpringBoot. Its sole purpose is to serve the Angular SPA to browsers.

In our spring micro service architecture this service depends on Eureka
Registry.

== Mandatory configuration, Profiles and default properties

The service has no mandatory configuration besside global configuration and
usual bootstrap configuration.

For other configuration see:

* {springboot_doc}/reference/htmlsingle/[Spring Boot documentation].
* {spring_doc}spring-framework-reference/web-reactive.html#webflux[Spring MVC documentation].

=== Service specific properties

|===
|name|default|mandatory?|Description

|operatorfabric.security.oauth2.flow.mode|PASSWORD|no|authentication mode (CODE: Authorization Code Flow, PASSWORD: Direct Password Flow)
|operatorfabric.security.oauth2.flow.provider|null|no|provider name to display on log in button
|operatorfabric.security.oauth2.flow.delegate-url|null|no|Url to redirect the browser to for authentication, mandatory with CODE flow
|operatorfabric.feed.subscription.timeout|60000|no|Milliseconds between card subscription renewal
|operatorfabric.feed.card.time.display|BUSINESS|no|card time display mode in the feed (BUSINESS: display card with entire business period,BUSINESS_START: display card with business start, PUBLICATION: display card with publication date,LTTD: : display card with lttd date,NONE: date is hidden)
|operatorfabric.feed.timeline.hide|false|no|If set to true, the time line is not loaded in the feed screen
|operatorfabric.settings.timeZone||no|Default user time zone for users (use browser time zone if not set)
|operatorfabric.settings.timeFormat|LT|no|Default user time format (moment)
|operatorfabric.settings.dateFormat|LL|no|Default user date format (moment)
|operatorfabric.settings.locale|LT|no|Default user locale (use browser if not set)
|operatorfabric.settings.default-tags||no|Default user list of filtered in tags

|===

NB: operatorfabric.settings are default values for user settings (See User Service)

=== default properties

Note that you must provide a bootstrap file with a convenient registry configuration

_bootstrap.yml_
```
include::../../main/resources/bootstrap.yml[]
```

_bootstrap-docker.yml_
```
include::../../main/resources/bootstrap-docker.yml[]
```

_bootstrap-dev.yml_
```
include::../../main/resources/bootstrap-dev.yml[]
```

The bootstrap-docker.yml file is a replacement bootstrap file we use for our
docker images configuration.

The bootstrap-dev.yml file is a replacement bootstrap file we use for our
development environment

The above embedded configurations are the basic settings of the application:

* it sets its service name
* it sets the configuration name to use (which configuration file to retrieve)
* it must set the registry service (example in bootstrap-docker.yml)

=== Sample developpement configuration

```
include::../../../../../infra/config/src/main/docker/volume/dev-configurations/web-ui.yml[]
```

=== Sample docker image configuration

```
include::../../../../../infra/config/src/main/docker/volume/docker-configurations/web-ui.yml[]
```

== Specifying external configuration properties when lauching a jar file

See {springboot_doc}/reference/htmlsingle/#boot-features-external-config-application-property-files[Application Property Files]
on how to setup an external spring properties or yml file.

See {springboot_doc}/reference/htmlsingle/#howto-set-active-spring-profiles[Set the Active Spring Profiles] for specifying alternate profile.


== Specifying configuration properties when lauching a docker image

Our docker image expects optional property file to be stored in the container
/service-config folder. You can bind so docker volume to this path to make
properties or yml available.

At time of writing, you cannot specify an alternate profile at runCards-Publication.
The default profiles activated are docker and native.

=== Available environment variables for docker image

* REGISTRY_HOST: Registry service host
* REGISTRY_PORT: Registry service port
* JAVA_OPTIONS: Additional java options

== Specifying configuration properties when lauching on Kubernetes

In progress

=== Available environment variables when launching on Kubernetes

* REGISTRY_HOST: Registry service host
* REGISTRY_PORT: Registry service port
* JAVA_OPTIONS: Additional java options